<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>

    <!-- START HEAD -->
    <th:block th:fragment="head(pageTitle)">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title th:text="${pageTitle}"></title>
        
        <!-- Favicon Declarations -->
		<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
		<link rel="manifest" href="/site.webmanifest" />
		<!-- <link rel="icon" type="image/x-icon" href="/favicon.ico">		 -->
		<link rel="icon" type="image/x-icon" href="/favicon.ico" sizes="32x32">
		<link rel="icon" href="/favicon.svg" type="image/svg+xml">
        <link rel="apple-touch-icon" href="/apple-touch-icon.png">
        
		<link rel="stylesheet" type="text/css" href="/css/bulma.css" />
		<link rel="stylesheet" href="/css/dark-mode.css">
		<link rel="stylesheet" href="/css/theme-overrides.css">
        <!-- Dark Mode JS -->
        <script src="/js/dark-mode.js" defer></script>

        <!-- Add any other truly common head elements here if needed -->
	</th:block>
<!-- END HEAD -->

 <!-- START TABLE SORTING RESOURCES -->
<th:block th:fragment="table-sort-resources">
    <link rel="stylesheet" type="text/css" href="/css/table-sort.css">
    <script type="text/javascript" src="/js/table-sort.js" defer></script>
</th:block>
<!-- END TABLE SORTING RESOURCES -->
 
<!-- START NAVBAR -->
<nav th:fragment="navbar" class="navbar has-background-primary-00 is-fixed-top">
	<div class="container ">
		<div class="navbar-brand">
			<a class="navbar-item brand-text has-text-warning" href="/"> intellectron </a>
			<div class="navbar-burger burger" data-target="navMenu">
				<span></span> <span></span> <span></span> <span></span>
			</div>
		</div>
		<div id="navMenu" class="navbar-menu">
			<div class="navbar-start">
				<a class="navbar-item has-text-warning" href="/"> Dashboard </a> 
				<a class="navbar-item has-text-warning" href="/search"> Search </a> 
				<a class="navbar-item has-text-warning" href="/input"> New Zettel </a>
			</div>
		</div>
		<!-- Add this in your header/navbar section -->
		<div class="navbar-end">
			<!-- User info display -->
			<div class="navbar-item" th:if="${isAuthenticated}">
				<span class="has-text-warning">
					<span class="icon">
						<i class="fas fa-user"></i>
					</span>
					<span th:text="${currentUser}">User</span>
				</span>
			</div>
			
			<div class="navbar-item">
				<button class="button is-small" id="darkModeToggle" aria-label="Dark mode toggle">
					<span class="icon">
						<i class="fas fa-moon"></i>
					</span>
				</button>
			</div>
			<div class="navbar-item">
				<form th:action="@{/logout}" method="post">
					<button type="submit" class="button is-small" id="logoutButton" aria-label="Logout" title="log out">
						<span class="icon">
							<img src="/images/logout.png" alt="Logout">
						</span>
					</button>
				</form>
			</div>
		</div>
	</div>
</nav>
<!-- END NAV -->

<!-- START SHOW ZETTELS IN TABLE-->
 
	<div th:fragment="zettel-table(zettels)">
		<table class="table is-fullwidth is-bordered is-striped has-background-grey-lighter thick-black-border sortable-table">
			<thead>
				<tr>
					<th>Identifier</th>
					<th>Topic</th>
					<th>Note</th>
					<th>Text Title</th>
					<th>Text</th>
					<th data-sort-method='none'>Tags</th>
					<th>References</th>
				</tr>
			</thead>
			<tbody>
				<tr th:if="${zettels.empty}">
					<td colspan="2">No Zettel Available</td>
				</tr>
				<tr th:each="zettel : ${zettels}">
					<td><a th:href="@{/zettel/{zettelId}(zettelId=${zettel.zettelId})}" target="_blank"
							rel="noopener noreferrer"><span class="showLast" th:text="${zettel.getHumanFriendlyIdentifier()}"> identifier
							</span></a></td>
					<td><span  th:text="${zettel.topic}"> topic </span></td>
					<td><span  th:if="${zettel.note!= null}"
							th:text="${zettel.note.noteText}">note</span></td>

					<td>
										<a th:href="@{/search/text/{textId}(textId=${zettel.tekst.textId})}"
						target="_blank" rel="noopener noreferrer">
					<span th:text="${zettel.tekst.title}"></span></a></td>

					<td><span th:text="${zettel.tekst.text}"></span></td>
					<td>
						<span th:if="${zettel.tags != null && !#lists.isEmpty(zettel.tags)}">
							<span th:each="tag, iterStat : ${zettel.tags}">
								<a th:href="@{/search/tag/{id}(id=${tag.id})}"
								   target="_blank" rel="noopener noreferrer"
								   th:text="${tag.tagText}">Tag Text</a>
								<span th:if="${!iterStat.last}"> ••• </span>
							</span>
						</span>
						<span th:if="${zettel.tags == null || #lists.isEmpty(zettel.tags)}">
							No tags
						</span>
					</td>
					<td>
						<span th:if="${zettel.references != null && !zettel.references.isEmpty()}">
							<span th:each="reference : ${zettel.references}">
								<a th:href="@{/zettel/{zettelId}(zettelId=${reference.targetZettelId})}"
								   target="_blank" rel="noopener noreferrer">
									<span th:switch="${reference.type.name()}">
										<span th:case="'SUPPORTS'" class="tag is-small is-success" style="font-size: 0.7rem;" th:text="${reference.type.name()} + ': Zettel ' + ${reference.targetZettelId}"></span>
										<span th:case="'CONTRADICTS'" class="tag is-small is-danger" style="font-size: 0.7rem;" th:text="${reference.type.name()} + ': Zettel ' + ${reference.targetZettelId}"></span>
										<span th:case="'FOLLOWS_FROM'" class="tag is-small is-info" style="font-size: 0.7rem;" th:text="${reference.type.name()} + ': Zettel ' + ${reference.targetZettelId}"></span>
										<span th:case="'BRANCHES_FROM'" class="tag is-small is-warning" style="font-size: 0.7rem;" th:text="${reference.type.name()} + ': Zettel ' + ${reference.targetZettelId}"></span>
										<span th:case="'RELATES_TO'" class="tag is-small is-primary" style="font-size: 0.7rem;" th:text="${reference.type.name()} + ': Zettel ' + ${reference.targetZettelId}"></span>
										<span th:case="*" class="tag is-small is-light" style="font-size: 0.7rem;" th:text="${reference.type.name()} + ': Zettel ' + ${reference.targetZettelId}"></span>
									</span>
								</a>
								<span th:if="${reference.connectionNote != null && !reference.connectionNote.isEmpty()}"
								class="has-text-grey is-italic"
									  th:text="' (' + ${#strings.abbreviate(reference.connectionNote, 60)} + ')'">
								</span>
								<br/>
							</span>
						</span>
						<span th:if="${zettel.references == null || zettel.references.isEmpty()}"
							  class="has-text-grey is-italic">
							No references
						</span>
					</td>
				</tr>
			</tbody>
		</table>
	</div>
	<!-- END SHOW ZETTELS IN TABLE -->
	
	
	<footer th:fragment="footer" class="hero-foot">
		<div class="container">
			<div class="content has-text-centered">
				<br>
				<p>
					<strong>Made with Bulma</strong> thanks to <a href="https://jgthms.com" target='_blank'
						rel='noopener noreferrer'>Jeremy Thomas & team</a>
				</p>
			</div>
		</div>
	</footer>
</body>
</html>