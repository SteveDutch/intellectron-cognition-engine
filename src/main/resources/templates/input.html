<!-- FILEPATH: /home/jeg/git/intellectron-cognition-engine/src/main/resources/templates/input.html -->
<!DOCTYPE html>
<html class="has-navbar-fixed-top" lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>feed your intellectron</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
 
	<link rel="stylesheet" href="/css/bulma.css">
	<link rel="stylesheet" href="/css/input.css">
	<link rel="stylesheet" href="/css/dark-mode.css">
	<script src="/js/input.js" defer></script>
	<script src="/js/enter-zettel.js" defer></script>
	<script src="/js/common.js" defer></script>
	<script src="/js/dark-mode.js" defer></script>
	<link rel="icon" type="image/x-icon" href="favicon.ico">
	<th:block th:replace="fragments/common :: table-sort-resources"></th:block>
	<th:block th:replace="fragments/common :: instant-ref-search-resources"></th:block>
	<th:block th:replace="fragments/common :: instant-ref-search-template"></th:block>
</head>

<body>
	<nav th:replace="fragments/common :: navbar"></nav>
	<section class="hero is-small is-danger">
		<div class="hero-body">
			<p class="title is-1 has-text-centered">Feed your intellectron</p>
			<p class="subtitle has-text-centered">with a new Zettel</p>
		</div>
	</section>

	<br />
	<form action="/input" method="post" th:object="${ZettelDtoRecord}">
		<!-- XXX ggffür 2 in 1 (input & zettel) 		<div> -->
		<!--             <p th:text="|ID: ${zettel.zettelId}|"></p> -->

		<!-- 			<p th:if="${zettel.zettelId == null}">new Zettel</p> -->
		<!-- 			<p th:if="${zettel.zettelId != null}" -->
		<!-- 				th:text="|ID: ${zettel.zettelId}|"></p> -->
		<!-- 		</div> -->
		<div class="columns">

			<div class="column is-2">
				<div class="field">
					<label class="label has-text-weight-bold" for="tags">Tags:</label>
					<div id="tagsContainer" class="tags">
						<div th:each="tag, status : ${tags}">
							<input type="text" th:id="'tag' + ${status.index}" th:name="'tags'"
								th:value="${tag.tagText}" />
							<button class="button is-small is-warning" type="button"
								onclick="this.parentNode.remove()">del</button>
						</div>
					</div>
					<button class="button is-small is-warning" id="addTagButton" type="button">Add Tag</button>
				</div>
				<hr />

				<div class="field">
					<label class="label has-text-weight-bold" for="authorFirstName">Author first name</label>
					<input type="text" id="authorFirstName" th:field="${author.authorFirstName}" />
				</div>

				<div class="field">
					<label class="label has-text-weight-bold" for="authorFamilyName">Author family name</label>
					<input type="text" id="authorFamilyName" th:field="${author.authorFamilyName}" />
				</div>
				<div class="field">
					<label class="label has-text-weight-bold" for="timestamp">Date of text:</label>
					<input type="date" id="timestamp" name="timestamp" th:field="${tekst.textDate}" />
				</div>

				<div class="field">
					<label class="label has-text-weight-bold" for="source">Source:</label>
					<input type="text" id="source" name="source" th:field="${tekst.source}" />
				</div>

			</div>



			<div class="column is-5">
				<div class="field">
					<label class="label has-text-weight-bold" for="title">Topic:</label>
					<div class="control">
						<textarea class="textarea is-link" placeholder="Topic" id="title" name="title" 
							th:field="${zettel.topic}" rows="3" autocomplete="on"></textarea>
					</div>
				</div>

				<div class="field">
					<label class="label has-text-weight-bold" for="notiz">Note:</label>
					<div class="control">
						<textarea class="textarea" id="notiz" name="article" 
							th:field="${note.noteText}" rows="10" autocomplete="on"></textarea>
					</div>
				</div>
			</div>

			<div class="column is-5">
				<div class="field">
					<label class="label has-text-weight-bold" for="texttitle">Title:</label>
					<div class="control">
						<textarea class="textarea" id="texttitle" name="title" 
							th:field="${tekst.title}" rows="3" autocomplete="on"></textarea>
					</div>
				</div>

				<div class="field">
					<label class="label has-text-weight-bold" for="tekst">Text:</label>
					<div class="control">
						<textarea class="textarea" id="tekst" th:field="${tekst.text}" 
							rows="10" autocomplete="on"></textarea>
					</div>
				</div>
			</div>
		</div>

		<hr />
		<div class="columns">
		<div class="column is-12">
			<label class="label has-text-weight-bold">Connected Zettels / Verknüpfte Zettel:</label>
			
			<!-- Container for all reference forms (existing and new) -->
			<div id="referencesContainer" class="columns is-multiline">
				
				<!-- Loop to render existing references as pre-filled forms -->
				<div th:each="ref : ${zettel.references}" class="column is-4 reference-group">
					<div class="box">
						<button type="button" class="button is-danger is-small is-pulled-right delete-reference-btn">Remove</button>
						<h6 class="subtitle is-6">Existing Reference:</h6>
						<div class="field">
							<label class="label">Reference Type:</label>
							<div class="select">
								<!-- The name attribute is critical for form submission -->
								<select name="referenceType">
									<!-- Loop through all possible enum values to create the options -->
									<option th:each="typeOpt : ${T(com.stevedutch.intellectron.domain.ReferenceType).values()}"
											th:value="${typeOpt}"
											th:text="${typeOpt.name()}"
											th:selected="${typeOpt == ref.type}">
									</option>
								</select>
							</div>
						</div>
						
						<div class="field">
							<label class="label">Target Zettel:</label>
							<div class="dropdown instant-ref-search-dropdown">
								<div class="dropdown-trigger">
									<!-- Pre-fill the value AND the data-zettel-id attribute -->
									<input type="text" class="input instant-ref-search-input"
										   name="zettelSearchInput"
										   th:value="${ref.targetZettel.getHumanFriendlyIdentifier()}"
										   th:attr="data-zettel-id=${ref.targetZettel.zettelId}" 
										   autocomplete="off" />
								</div>
								<div class="dropdown-menu" role="menu">
									<div class="dropdown-content"></div>
								</div>
							</div>
						</div>
						
						<div class="field">
							<label class="label">Connection Note (optional):</label>
							<!-- Pre-fill the connection note -->
							<input type="text" class="input" name="connectionNote"
								   th:value="${ref.connectionNote}" 
								   placeholder="Why are these notes connected?" />
						</div>
					</div>
				</div>

				<!-- The template for a brand new reference form. It will be cloned by JS. -->
				<div class="column is-4 reference-group is-hidden" id="reference-template">
					<div class="box">
						<button type="button" class="button is-danger is-small is-pulled-right delete-reference-btn">Remove</button>
						<h6 class="subtitle is-6">Add New Reference:</h6>
						<div class="field">
							<label class="label">Reference Type:</label>
							<div class="select">
								<select name="referenceType">
									<option th:each="typeOpt : ${T(com.stevedutch.intellectron.domain.ReferenceType).values()}"
											th:value="${typeOpt}"
											th:text="${typeOpt.name()}"></option>
								</select>
							</div>
						</div>
						<div class="field">
							<label class="label">Target Zettel:</label>
							<div class="dropdown instant-ref-search-dropdown">
								<div class="dropdown-trigger">
									<input type="text" class="input instant-ref-search-input"
										   name="zettelSearchInput"
										   placeholder="Start typing to search..."
										   autocomplete="off" />
								</div>
								<div class="dropdown-menu" role="menu">
									<div class="dropdown-content"></div>
								</div>
							</div>
						</div>
						<div class="field">
							<label class="label">Connection Note (optional):</label>
							<input type="text" class="input" name="connectionNote" placeholder="Why are these notes connected?" />
						</div>
					</div>
				</div>
			</div>

			<!-- Button to add a new reference form -->
			<button class="button is-primary" type="button" id="add-reference-btn">Add Another Reference</button>
		</div>
	</div>
			<div class="columns">
			<div class="column ">
				<input class="button is-dark is-medium is-rounded" type="submit" id="submit" value="Submit" />
			</div>
		</div>
	</form>

	<section class="hero is-small is-warning">
		<div class="hero-body">
			<p class="title  has-text-centered ">last 10 zettels</p>
		</div>
	</section>
	<div th:replace="fragments/common :: zettel-table(zettels=${zettels})"></div>

	<section class="hero is-small is-danger">
		<div class="hero-body">
			<p class="title has-text-centered">10 random zettels</p>

		</div>
	</section>
	<div th:replace="fragments/common :: zettel-table(zettels=${randomZettels})"></div>

	<footer th:replace="fragments/common :: footer"></footer>

	<!-- navbar burger -->
	<script type="text/javascript" src="/js/bulma.js"></script>
	
	<!-- Instant Reference Search Template - made by genAI -->
	<th:block th:replace="fragments/common :: instant-ref-search-template"></th:block>
</body>

</html>